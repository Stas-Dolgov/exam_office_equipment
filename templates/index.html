{% extends 'base.html' %}
{% block content %}
    <h1>Список оборудования</h1>

    <form method="GET" action="/">
        <label for="category">Категория:</label>
        <select name="category" id="category">
            <option value="">Все</option>
            {% for category in categories %}
                <option value="{{ category.id }}" {% if category_filter == category.id|string %}selected{% endif %}>{{ category.name }}</option>
            {% endfor %}
        </select>

        <label for="status">Статус:</label>
        <select name="status" id="status">
            <option value="">Все</option>
            {% for status in statuses %}
                <option value="{{ status }}" {% if status_filter == status %}selected{% endif %}>{{ status }}</option>
            {% endfor %}
        </select>
        <label for="date_from">Дата от:</label>
        <input type="date" name="date_from" id="date_from" value="{{ date_from }}">

        <label for="date_to">Дата до:</label>
        <input type="date" name="date_to" id="date_to" value="{{ date_to }}">
        <button type="submit">Фильтр</button>
    </form>

    <table class="table">
        <thead>
            <tr>
                <th><a href="?page={{ pagination.page }}&sort_by=name&sort_order={% if sort_by == 'name' and sort_order == 'asc' %}desc{% else %}asc{% endif %}">Название</a></th>
                <th><a href="?page={{ pagination.page }}&sort_by=inventory_number&sort_order={% if sort_by == 'inventory_number' and sort_order == 'asc' %}desc{% else %}asc{% endif %}">Инвентарный номер</a></th>
                <th><a href="?page={{ pagination.page }}&sort_by=category&sort_order={% if sort_by == 'category' and sort_order == 'asc' %}desc{% else %}asc{% endif %}">Категория</a></th>
                <th><a href="?page={{ pagination.page }}&sort_by=status&sort_order={% if sort_by == 'status' and sort_order == 'asc' %}desc{% else %}asc{% endif %}">Статус</a></th>
                <th><a href="?page={{ pagination.page }}&sort_by=purchase_date&sort_order={% if sort_by == 'purchase_date' and sort_order == 'asc' %}desc{% else %}asc{% endif %}">Дата покупки</a></th>
                <th>Действия</th>
            </tr>
        </thead>
        <tbody>
            {% for equipment in equipments %}
                <tr>
                    <td>{{ equipment.name }}</td>
                    <td>{{ equipment.inventory_number }}</td>
                    <td>{{ equipment.category.name }}</td>
                    <td>{{ equipment.status }}</td>
                    <td>{{ equipment.purchase_date.strftime('%Y-%m-%d') }}</td>
                    <td>
                        <a href="#">Просмотр</a> <!-- Replace '#' with actual URL -->
                        {% if current_user.role == 'admin' %}
                            <a href="{{ url_for('edit_equipment', id=equipment.id) }}">Редактировать</a>
                            <a href="#">Удалить</a> <!-- Replace '#' with actual URL -->
                        {% elif current_user.role == 'tech' %}
                            <a href="#">Добавить запись об обслуживании</a> <!-- Replace '#' with actual URL -->
                        {% endif %}
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>

    {% if pagination.total > pagination.per_page %}
        <div class="pagination">
            {% if pagination.has_prev %}
                <a href="?page={{ pagination.prev_num }}&sort_by={{ sort_by }}&sort_order={{ sort_order }}&category={{ category_filter or '' }}&status={{ status_filter or '' }}&date_from={{ date_from or '' }}&date_to={{ date_to or '' }}">Предыдущая</a>
            {% endif %}

            {% for page_num in pagination.iter_pages(left_edge=2, right_edge=2, left_current=2, right_current=2) %}
                {% if page_num %}
                    {% if pagination.page == page_num %}
                        <span class="current">{{ page_num }}</span>
                    {% else %}
                         <a href="?page={{ page_num }}&sort_by={{ sort_by }}&sort_order={{ sort_order }}&category={{ category_filter or '' }}&status={{ status_filter or '' }}&date_from={{ date_from or '' }}&date_to={{ date_to or '' }}">{{ page_num }}</a>
                    {% endif %}
                {% else %}
                    <span class="ellipsis">…</span>
                {% endif %}
            {% endfor %}

            {% if pagination.has_next %}
                 <a href="?page={{ pagination.next_num }}&sort_by={{ sort_by }}&sort_order={{ sort_order }}&category={{ category_filter or '' }}&status={{ status_filter or '' }}&date_from={{ date_from or '' }}&date_to={{ date_to or '' }}">Следующая</a>
            {% endif %}
        </div>
    {% endif %}
{% endblock %}